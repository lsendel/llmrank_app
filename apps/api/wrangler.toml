name = "llm-boost-api"
main = "src/index.ts"
compatibility_date = "2025-12-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

routes = [
  { pattern = "api.llmrank.app/*", zone_name = "llmrank.app" }
]

[[services]]
binding = "WEB_WORKER"
service = "llm-boost-web"

[[r2_buckets]]
binding = "R2"
bucket_name = "ai-seo-storage"

[[kv_namespaces]]
binding = "KV"
id = "a1b4b94676c04ac997f69d2a5ca03dad"

[[kv_namespaces]]
binding = "SEEN_URLS"
id = "890e3a5ce54f4c3883556dce292ceb20"

[[queues.producers]]
binding = "CRAWL_QUEUE"
queue = "llm-boost-crawls"

[[queues.producers]]
binding = "REPORT_QUEUE"
queue = "llm-boost-reports"

[browser]
binding = "BROWSER"

[vars]
CRAWLER_URL = "https://llmrank-crawler.fly.dev"
REPORT_SERVICE_URL = "https://llm-boost-reports.fly.dev"
APP_BASE_URL = "https://llmrank.app"
BETTER_AUTH_URL = "https://api.llmrank.app"

[env.preview]
[env.preview.vars]
APP_BASE_URL = "https://staging.llmrank.app"
BETTER_AUTH_URL = "https://api-staging.llmrank.app"

[env.production]
[env.production.vars]
APP_BASE_URL = "https://llmrank.app"
BETTER_AUTH_URL = "https://api.llmrank.app"

[triggers]
crons = ["0 0 1 * *", "*/5 * * * *", "*/15 * * * *", "0 3 * * *", "0 4 * * *", "0 9 * * 1", "0 9 1 * *", "0 2 * * 7"] # Reset monthly + Scheduled crawls every 5 min + Visibility checks every 15 min + Daily cleanup 3AM + Benchmark aggregation 4AM + Weekly digest Mon 9AM + Monthly digest 1st 9AM + Competitor monitoring Sun 2AM

# Secrets (set via `wrangler secret put`):
# DATABASE_URL, SHARED_SECRET, ANTHROPIC_API_KEY, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET,
# CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY, RESEND_API_KEY
